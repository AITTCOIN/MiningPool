"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getAndClearEvents = exports.write = exports.createShim = void 0;
const perfTrace = require("./perf-trace");
// eslint-disable-next-line @typescript-eslint/no-var-requires
const MODULE = require('module');
const REQUIRE_SO_SLOW = Symbol('require-so-slow-monkey-patch');
function createShim() {
    const orig = MODULE._load;
    if (orig[REQUIRE_SO_SLOW]) {
        return;
    }
    MODULE._load = function (request) {
        // eslint-disable-next-line prefer-rest-params
        const args = arguments;
        let exports;
        perfTrace.wrap(`require ${request}`, () => {
            exports = orig.apply(this, args);
        });
        return exports;
    };
    MODULE._load[REQUIRE_SO_SLOW] = true;
}
exports.createShim = createShim;
function write(path) {
    perfTrace.write(path);
}
exports.write = write;
function getAndClearEvents() {
    return perfTrace.getAndClearEvents();
}
exports.getAndClearEvents = getAndClearEvents;
//# sourceMappingURL=shim.js.map